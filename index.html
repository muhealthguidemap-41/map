<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MU Health Guide Map | แผนที่บริการสุขภาพมหิดล ศาลายา</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; scroll-behavior: smooth; }
        #map { height: 550px; width: 100%; border-radius: 1rem; z-index: 10; }
        .custom-popup .leaflet-popup-content-wrapper { border-radius: 0.75rem; padding: 0; overflow: hidden; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .custom-popup .leaflet-popup-content { margin: 0; width: 260px !important; }
        .logo-shadow { filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); }
        #info-modal { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease; }
        .hidden-modal { opacity: 0; pointer-events: none; }
        .hidden-modal .modal-content { transform: scale(0.95); }
        
        /* Animation สำหรับจุดผู้ใช้งาน */
        .user-pulse {
            width: 14px; height: 14px; background: #3B82F6; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            animation: pulse-blue 2s infinite;
        }
        @keyframes pulse-blue {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 relative">

    <nav class="bg-blue-900 text-white sticky top-0 z-[50] shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="flex-shrink-0 logo-shadow bg-white p-1.5 rounded-xl">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="#EF4444"/>
                            <path d="M16 7C16 5.5 15 4.5 13.5 4.5S11 5.5 11 7V10C11 11.5 12 12.5 13.5 12.5S16 11.5 16 10" stroke="white" stroke-width="1.2" stroke-linecap="round"/>
                            <path d="M13.5 12.5V15" stroke="white" stroke-width="1.2" stroke-linecap="round"/>
                            <circle cx="13.5" cy="16.5" r="1.5" fill="white"/>
                        </svg>
                    </div>
                    <span class="font-bold text-lg md:text-xl tracking-tight">MU Health Guide Map</span>
                </div>
                <div class="hidden md:flex space-x-1">
                    <a href="#" class="px-4 py-2 rounded-lg text-sm font-medium hover:bg-white/10 transition">หน้าหลัก</a>
                    <a href="#map-section" class="px-4 py-2 rounded-lg text-sm font-medium hover:bg-white/10 transition">แผนที่นำทาง</a>
                </div>
            </div>
        </div>
    </nav>

    <header class="bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900 text-white py-14 px-4 text-center relative overflow-hidden">
        <div class="relative z-10 max-w-4xl mx-auto">
            <h1 class="text-3xl md:text-5xl font-extrabold mb-4 drop-shadow-sm">ดูแลสุขภาพชาวมหิดลให้ง่ายขึ้น</h1>
            <p class="text-blue-100 text-base md:text-lg mb-10 font-light max-w-2xl mx-auto">รวบรวมข้อมูลบริการสุขภาพ เวลาทำการ และพิกัดสถานที่สำคัญภายในพื้นที่ศาลายา</p>
            
            <div class="flex flex-wrap justify-center gap-3 bg-black/10 p-2 rounded-2xl backdrop-blur-sm inline-flex">
                <button onclick="filterLocations('all')" class="bg-blue-600 text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-500 transition shadow-md filter-btn" data-cat="all">ทั้งหมด</button>
                <button onclick="filterLocations('hospital')" class="bg-white text-blue-900 px-5 py-2.5 rounded-xl font-bold hover:bg-blue-50 transition flex items-center gap-2 shadow-sm filter-btn" data-cat="hospital"><i data-lucide="hospital" size="18"></i> โรงพยาบาล</button>
                <button onclick="filterLocations('dental')" class="bg-white text-blue-900 px-5 py-2.5 rounded-xl font-bold hover:bg-blue-50 transition flex items-center gap-2 shadow-sm filter-btn" data-cat="dental">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M7,2C4,2,2,5,2,9c0,4,2,6,2,9c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4c0-1,0.5-2,1-2s1,1,1,2c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4c0-3,2-5,2-9c0-4-2-7-5-7C16,2,14,3,12,3S8,2,7,2z M8,13c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S9.1,13,8,13z M16,13c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S17.1,13,16,13z"/></svg>
                    ทันตกรรม
                </button>
                <button onclick="filterLocations('clinic')" class="bg-white text-blue-900 px-5 py-2.5 rounded-xl font-bold hover:bg-blue-50 transition flex items-center gap-2 shadow-sm filter-btn" data-cat="clinic"><i data-lucide="stethoscope" size="18"></i> คลินิก</button>
                <button onclick="filterLocations('pharmacy')" class="bg-white text-blue-900 px-5 py-2.5 rounded-xl font-bold hover:bg-blue-50 transition flex items-center gap-2 shadow-sm filter-btn" data-cat="pharmacy"><i data-lucide="pill" size="18"></i> ร้านยา</button>
                <button onclick="filterLocations('fitness')" class="bg-white text-blue-900 px-5 py-2.5 rounded-xl font-bold hover:bg-blue-50 transition flex items-center gap-2 shadow-sm filter-btn" data-cat="fitness"><i data-lucide="dumbbell" size="18"></i> ออกกำลังกาย</button>
                <button onclick="filterLocations('service')" class="bg-white text-blue-900 px-5 py-2.5 rounded-xl font-bold hover:bg-blue-50 transition flex items-center gap-2 shadow-sm filter-btn" data-cat="service"><i data-lucide="heart-handshake" size="18"></i> บริการเสริม</button>
            </div>
        </div>
        <div class="absolute top-0 right-0 -mr-24 -mt-24 w-80 h-80 bg-blue-500/20 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 -ml-24 -mb-24 w-96 h-96 bg-indigo-500/20 rounded-full blur-3xl"></div>
    </header>

    <main id="map-section" class="max-w-7xl mx-auto px-4 py-10 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
            
            <div class="col-span-1 lg:hidden order-1 mb-2">
                <h2 class="text-2xl font-bold text-blue-900 flex items-center gap-2">
                    <div class="bg-blue-100 p-2 rounded-lg"><i data-lucide="map-pin" class="text-blue-700"></i></div>
                    จุดบริการสุขภาพ
                </h2>
                <p class="text-sm text-slate-500 mt-1 ml-1">*เลือกสถานที่เพื่อดูรายละเอียดและสิทธิรักษา</p>
            </div>

            <div class="col-span-1 lg:col-span-8 lg:col-start-5 order-2 lg:order-2">
                <div class="bg-white p-2.5 rounded-3xl shadow-sm border border-slate-200 overflow-hidden relative group h-full">
                    <div id="map"></div>
                    
                    <button onclick="findUserLocation()" class="absolute top-4 right-4 z-[400] bg-white text-blue-600 p-3 rounded-xl shadow-lg border border-slate-100 hover:bg-blue-50 transition group-hover:scale-105 flex items-center gap-2 font-bold text-sm">
                        <i data-lucide="crosshair"></i> ค้นหาตำแหน่งฉัน
                    </button>
                </div>
            </div>

            <div class="col-span-1 lg:col-span-4 lg:col-start-1 lg:row-start-1 order-3 lg:order-1">
                <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                    <h2 class="hidden lg:flex text-xl font-bold mb-5 items-center gap-3 text-blue-900">
                        <div class="bg-blue-100 p-2 rounded-lg"><i data-lucide="map-pin" class="text-blue-700"></i></div>
                        จุดบริการสุขภาพ
                    </h2>
                    <p class="hidden lg:block text-xs text-slate-500 mb-2">*คลิกที่ชื่อเพื่อดูรายละเอียดและสิทธิรักษา</p>
                    
                    <div id="user-status" class="hidden mb-3 p-2 bg-blue-50 text-blue-700 text-xs rounded-lg border border-blue-100 flex items-center gap-2">
                        <i data-lucide="map-pin" size="14"></i> แสดงระยะห่างจากตำแหน่งของคุณ
                    </div>

                    <div id="location-list" class="space-y-3 transition-all duration-500 max-h-[500px] overflow-y-auto pr-1">
                        </div>
                    
                    <button id="show-more-btn" onclick="toggleShowMore()" class="hidden w-full mt-4 py-2 text-sm text-blue-600 font-bold bg-blue-50 hover:bg-blue-100 rounded-xl transition">
                        ดูเพิ่มเติม ...
                    </button>
                </div>
            </div>

            <div class="col-span-1 lg:col-span-4 lg:col-start-1 order-4 lg:order-3">
                <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-200">
                    <h2 class="text-xl font-bold mb-5 flex items-center gap-3 text-indigo-900">
                        <div class="bg-indigo-100 p-2 rounded-lg"><i data-lucide="shield-check" class="text-indigo-700"></i></div>
                        สิทธิและบริการสุขภาพ
                    </h2>
                    <div class="space-y-3">
                         <a href="https://sites.google.com/mahidol.edu/sa-health-welfare/%E0%B8%AB%E0%B8%99%E0%B8%B2%E0%B9%81%E0%B8%A3%E0%B8%81?authuser=0" target="_blank" class="group block p-4 rounded-2xl border border-slate-100 bg-white hover:border-pink-200 hover:shadow-lg hover:shadow-pink-100 transition-all duration-300 hover:-translate-y-1 relative overflow-hidden">
                            <div class="flex items-center gap-4 relative z-10">
                                <div class="bg-pink-100 text-pink-600 p-3 rounded-xl group-hover:scale-110 transition-transform shadow-sm"><i data-lucide="heart-pulse"></i></div>
                                <div class="flex-1"><span class="font-bold text-slate-700 text-sm group-hover:text-pink-700 block transition-colors">Mahidol Health (Welfare)</span><span class="text-xs text-slate-500">ข้อมูลสวัสดิการสุขภาพ</span></div>
                                <i data-lucide="chevron-right" size="20" class="text-slate-300 group-hover:text-pink-500 transition-colors"></i>
                            </div>
                         </a>
                         <a href="https://mahidol.ac.th/new-current-student/student-health-care/?utm_source=chatgpt.com" target="_blank" class="group block p-4 rounded-2xl border border-slate-100 bg-white hover:border-blue-200 hover:shadow-lg hover:shadow-blue-100 transition-all duration-300 hover:-translate-y-1 relative overflow-hidden">
                            <div class="flex items-center gap-4 relative z-10">
                                <div class="bg-blue-100 text-blue-600 p-3 rounded-xl group-hover:scale-110 transition-transform shadow-sm"><i data-lucide="globe-2"></i></div>
                                <div class="flex-1"><span class="font-bold text-slate-700 text-sm group-hover:text-blue-700 block transition-colors">เว็บไซต์หน่วยบริการสุขภาพ</span><span class="text-xs text-slate-500">เข้าสู่เว็บไซต์หลัก</span></div>
                                <i data-lucide="chevron-right" size="20" class="text-slate-300 group-hover:text-blue-500 transition-colors"></i>
                            </div>
                         </a>
                         <a href="https://mahidol.ac.th/new-current-student/student-health-care/?utm_source=chatgpt.com" target="_blank" class="group block p-4 rounded-2xl border border-slate-100 bg-white hover:border-indigo-200 hover:shadow-lg hover:shadow-indigo-100 transition-all duration-300 hover:-translate-y-1 relative overflow-hidden">
                            <div class="flex items-center gap-4 relative z-10">
                                <div class="bg-indigo-100 text-indigo-600 p-3 rounded-xl group-hover:scale-110 transition-transform shadow-sm"><i data-lucide="network"></i></div>
                                <div class="flex-1"><span class="font-bold text-slate-700 text-sm group-hover:text-indigo-700 block transition-colors">ข้อมูลเครือข่ายหน่วยบริการ</span><span class="text-xs text-slate-500">รายชื่อโรงพยาบาลในเครือข่าย</span></div>
                                <i data-lucide="chevron-right" size="20" class="text-slate-300 group-hover:text-indigo-500 transition-colors"></i>
                            </div>
                         </a>
                         <a href="https://mahidol.ac.th/new-current-student/student-health-care/?utm_source=chatgpt.com" target="_blank" class="group block p-4 rounded-2xl border border-slate-100 bg-white hover:border-teal-200 hover:shadow-lg hover:shadow-teal-100 transition-all duration-300 hover:-translate-y-1 relative overflow-hidden">
                            <div class="flex items-center gap-4 relative z-10">
                                <div class="bg-teal-100 text-teal-600 p-3 rounded-xl group-hover:scale-110 transition-transform shadow-sm">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M7,2C4,2,2,5,2,9c0,4,2,6,2,9c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4c0-1,0.5-2,1-2s1,1,1,2c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4c0-3,2-5,2-9c0-4-2-7-5-7C16,2,14,3,12,3S8,2,7,2z M8,13c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S9.1,13,8,13z M16,13c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S17.1,13,16,13z"/></svg>
                                </div>
                                <div class="flex-1"><span class="font-bold text-slate-700 text-sm group-hover:text-teal-700 block transition-colors">หน่วยบริการทันตกรรม</span><span class="text-xs text-slate-500">คลินิกทำฟันนักศึกษา</span></div>
                                <i data-lucide="chevron-right" size="20" class="text-slate-300 group-hover:text-teal-500 transition-colors"></i>
                            </div>
                         </a>
                    </div>
                </div>
            </div>

            <div class="col-span-1 lg:col-span-8 lg:col-start-5 order-5 lg:order-4">
                <div class="bg-blue-50 border border-blue-100 p-5 rounded-3xl flex items-start gap-4">
                    <div class="bg-blue-500 p-3 rounded-2xl text-white shadow-sm"><i data-lucide="clock"></i></div>
                    <div>
                        <h4 class="font-bold text-blue-900 mb-1 leading-tight text-lg">เวลาทำการคลินิก (MU Health)</h4>
                        <p class="text-blue-800 text-sm leading-relaxed">หน่วยตรวจโรคทั่วไป เปิดทำการ จันทร์-ศุกร์ เวลา 08.30 - 16.30 น. (ปิดวันหยุดราชการ)</p>
                    </div>
                </div>
            </div>

            <div class="col-span-1 lg:col-span-4 lg:col-start-1 order-6 lg:order-5">
                <div id="emergency" class="bg-red-600 p-6 rounded-3xl shadow-lg text-white relative overflow-hidden">
                    <div class="relative z-10">
                        <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                            <i data-lucide="phone-call" class="animate-pulse"></i> สายด่วนฉุกเฉิน 24 ชม.
                        </h3>
                        <div class="bg-white/10 backdrop-blur-md rounded-2xl p-4 border border-white/20">
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-sm font-medium">หน่วยกู้ชีพมหิดล</span>
                                <span class="text-xl font-black tracking-tighter">02-849-1999</span>
                            </div>
                            <a href="tel:028491999" class="block w-full bg-white text-red-600 py-2.5 rounded-xl font-bold text-center hover:bg-red-50 transition shadow-lg flex items-center justify-center gap-2">
                                <i data-lucide="phone" size="18"></i> โทรออกทันที
                            </a>
                        </div>
                    </div>
                    <i data-lucide="phone" size="100" class="absolute -bottom-5 -right-5 text-white/10 rotate-12"></i>
                </div>
            </div>

        </div>
    </main>

    <div id="info-modal" class="fixed inset-0 z-[200] flex items-center justify-center bg-black/50 hidden-modal backdrop-blur-sm">
        <div class="modal-content bg-white w-full max-w-md mx-4 rounded-3xl shadow-2xl overflow-hidden relative max-h-[90vh] overflow-y-auto">
            <button onclick="closeModal()" class="absolute top-4 right-4 bg-slate-100 hover:bg-slate-200 p-2 rounded-full transition z-50"><i data-lucide="x" class="text-slate-600"></i></button>
            <div class="p-6">
                <div id="modal-icon" class="w-16 h-16 rounded-2xl bg-blue-100 text-blue-600 flex items-center justify-center mb-4 mx-auto"></div>
                <h3 id="modal-title" class="text-2xl font-bold text-center text-slate-800 mb-2">ชื่อสถานที่</h3>
                <p id="modal-desc" class="text-center text-slate-500 mb-6 text-sm">รายละเอียด</p>
                
                <div class="space-y-3 bg-slate-50 p-4 rounded-2xl border border-slate-100">
                    <div class="flex items-start gap-3"><i data-lucide="clock" class="text-blue-500 mt-0.5 shrink-0" size="18"></i><div><span class="font-bold text-slate-700 text-sm block">เวลาทำการ:</span><span id="modal-hours" class="text-slate-600 text-sm">-</span></div></div>
                    <div class="flex items-start gap-3"><i data-lucide="info" class="text-blue-500 mt-0.5 shrink-0" size="18"></i><div><span class="font-bold text-slate-700 text-sm block">บริการเพิ่มเติม:</span><span id="modal-details" class="text-slate-600 text-sm">-</span></div></div>
                </div>

                <div id="modal-rights-section" class="mt-4 space-y-3">
                    </div>

                <div class="mt-6 flex gap-3">
                    <a id="modal-tel-btn" href="#" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-bold text-center flex items-center justify-center gap-2 transition shadow-lg shadow-green-200"><i data-lucide="phone"></i> โทรออก</a>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-slate-900 text-slate-400 py-8 text-center text-sm mt-10"><p>© 2024 Mahidol University Health Guide Map. All rights reserved.</p></footer>

    <script>
        const TOOTH_SVG = `<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="currentColor"><path d="M7,2C4,2,2,5,2,9c0,4,2,6,2,9c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4c0-1,0.5-2,1-2s1,1,1,2c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4c0-3,2-5,2-9c0-4-2-7-5-7C16,2,14,3,12,3S8,2,7,2z M8,13c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S9.1,13,8,13z M16,13c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S17.1,13,16,13z"/></svg>`;

        const locations = [
            { 
                id: 1, 
                name: "ศูนย์การแพทย์กาญจนาภิเษก", 
                category: "hospital", 
                lat: 13.7915, 
                lng: 100.3245, 
                desc: "โรงพยาบาลหลัก", 
                tel: "02-849-6600", 
                icon: "hospital", 
                hours: "เปิดทำการทุกวัน 24 ชั่วโมง (แผนกฉุกเฉิน)", 
                details: "มีคลินิกนอกเวลา",
                rights: "นักศึกษามหาวิทยาลัยมหิดลมีสิทธิเข้ารับบริการที่ศูนย์ฯ ศาลายา",
                docs: "บัตรนักศึกษา บัตรประชาชน Passport (สำหรับนักศึกษาต่างชาติ)"
            },
            
            // --- Clinic ---
            { 
                id: 2, 
                name: "หน่วยตรวจโรคทั่วไป (MU Health)", 
                category: "clinic", 
                lat: 13.7938, 
                lng: 100.3205, 
                desc: "อาคาร MLC ชั้น 1", 
                tel: "02-849-4529", 
                icon: "stethoscope", 
                hours: "จันทร์ - ศุกร์: 08.30 - 16.30 น.", 
                details: "ตรวจรักษาโรคทั่วไปเบื้องต้น",
                rights: "นักศึกษามหาวิทยาลัยมหิดลสามารถเข้ารับบริการได้ทันที"
            },
            { 
                id: 5, 
                name: "คลินิกกายภาพบำบัด", 
                category: "clinic", 
                lat: 13.7955, 
                lng: 100.3160, 
                desc: "อาคารคณะกายภาพบำบัด", 
                tel: "02-xxx-xxxx", 
                icon: "activity", 
                hours: "จันทร์ - ศุกร์: 08.30 - 19.30 น.", 
                details: "รักษาออฟฟิศซินโดรม, บาดเจ็บจากการเล่นกีฬา",
                rights: "ต้องสำรองจ่ายก่อน แต่สามารถนำใบเสร็จไปเบิกค่ารักษาตามสิทธิ์ของทางราชการได้"
            },
            { 
                id: 201, 
                name: "คลินิกเวชกรรมใกล้ฉัน ศาลายา", 
                category: "clinic", 
                lat: 13.7985, 
                lng: 100.3260, 
                desc: "บริการตรวจรักษาโรคทั่วไป", 
                tel: "-", 
                icon: "stethoscope", 
                hours: "08.00 - 20.00 น.", 
                details: "บริการตรวจโรคทั่วไปและออกใบรับรองแพทย์",
                rights: "คลินิกไม่ได้เข้าร่วมประกันสังคม"
            },
            { 
                id: 202, 
                name: "คลินิกการกีฬา มหาวิทยาลัยมหิดล", 
                category: "clinic", 
                lat: 13.7920, 
                lng: 100.3250, 
                desc: "ดูแลนักกีฬาและผู้บาดเจ็บ", 
                tel: "-", 
                icon: "activity", 
                hours: "จันทร์ - ศุกร์: 09.00 - 17.00 น.", 
                details: "ให้คำปรึกษาและฟื้นฟูสมรรถภาพนักกีฬา",
                rights: "นักศึกษามหาวิทยาลัยมหิดลสามารถเข้าใช้สิทธิได้ตามการนัดหมาย"
            },

            // --- Pharmacy ---
            { id: 301, name: "มิตรประชาเมดิคัล MitrPracha Medical", category: "pharmacy", lat: 13.8020, lng: 100.3250, desc: "หน้า ม.มหิดล", tel: "-", icon: "pill", hours: "เปิดทุกวัน 08.00 - 21.00 น.", details: "จำหน่ายยา เวชภัณฑ์" },
            { id: 302, name: "ร้านยาเที่ยงคืน", category: "pharmacy", lat: 13.8050, lng: 100.3220, desc: "ตลาดศาลายา", tel: "-", icon: "pill", hours: "เปิดทุกวัน ถึง 24.00 น.", details: "บริการเภสัชกรรมชุมชน" },
            { id: 303, name: "ศาลายาเภสัช", category: "pharmacy", lat: 13.8040, lng: 100.3200, desc: "หน้าตลาดสดศาลายา", tel: "-", icon: "pill", hours: "เปิดทุกวัน 07.00 - 20.00 น.", details: "ร้านขายยาประจำท้องถิ่น" },
            { id: 304, name: "ร้านยาศิริราชบำรุงเวช", category: "pharmacy", lat: 13.7915, lng: 100.3245, desc: "ศูนย์การแพทย์กาญจนาภิเษก", tel: "-", icon: "pill", hours: "ตามเวลาราชการ", details: "จำหน่ายยาและเวชภัณฑ์คุณภาพ รพ.ศิริราช" },
            { id: 305, name: "มายเภสัช", category: "pharmacy", lat: 13.7980, lng: 100.3150, desc: "บริการด้วยใจ", tel: "-", icon: "pill", hours: "เปิดทุกวัน 09.00 - 21.00 น.", details: "ให้คำปรึกษาเรื่องยาโดยเภสัชกร" },
            { id: 306, name: "ศาลายาเภสัช สาขา 2", category: "pharmacy", lat: 13.8060, lng: 100.3210, desc: "สาขาตลาดใหม่", tel: "-", icon: "pill", hours: "เปิดทุกวัน 08.00 - 20.00 น.", details: "สาขาเพิ่มเติม" },
            { id: 4, name: "ร้านยาเภสัชชุมชน", category: "pharmacy", lat: 13.7945, lng: 100.3225, desc: "หน้า ม.มหิดล ประตู 4", tel: "02-xxx-xxxx", icon: "pill", hours: "ทุกวัน: 08.00 - 20.00 น.", details: "จำหน่ายยาโดยเภสัชกร" },
            
            // --- Dental ---
            { 
                id: 3, 
                name: "รพ.ทันตกรรม คณะทันตแพทยศาสตร์", 
                category: "dental", 
                lat: 13.7910, 
                lng: 100.3180, 
                desc: "ให้บริการทางทันตกรรม", 
                tel: "02-849-6000", 
                icon: "tooth", 
                hours: "จันทร์ - ศุกร์: 08.30 - 16.00 น.", 
                details: "อุดฟัน ถอนฟัน ขูดหินปูน ผ่าฟันคุด (นัดหมายล่วงหน้า)",
                rights: "-ฟรี อุดฟัน ขูดหินน้ำลาย ผนึกหลุมร่องฟัน รักษารากฟันหน้า ฟันปลอมทั้งปาก (มีเงื่อนไขโครงการ)<br>-ลด50% ฟันปลอมบางส่วนถอดได้ (ไม่รวมค่า Lab โลหะ) ครอบฟันและสะพานฟัน (ไม่รวมค่า Lab)<br>-สิทธิบัตรทอง อุดฟัน ถอนฟัน ขูดหินปูน ผ่าฟันคุด ให้ฟลูออไรด์เสริม ใส่ฟันเทียมฐานพลาสติก",
                docs: "บัตรประชาชน และบัตรนักศึกษา"
            },
            { 
                id: 101, 
                name: "คลินิกไอสไมล์ ศาลายา", 
                category: "dental", 
                lat: 13.8010, 
                lng: 100.3250, 
                desc: "จัดฟัน รากเทียม วีเนียร์", 
                tel: "-", 
                icon: "tooth", 
                hours: "10.00 - 20.00 น.", 
                details: "บริการทางทันตกรรมครบวงจร",
                rights: "-โปรโมชันสำหรับนักศึกษาต้องสอบถามโดยตรง<br>-ประกันสังคม ขูดหินปูน อุดฟัน ฟรี<br>-โปรเดือนเกิด รับฟรีไหมขัดฟัน และต้องสอบถามโปรโมชันปัจจุบัน"
            },
            { 
                id: 102, 
                name: "คลินิกทันตกรรม เด็นทิสเตอร์", 
                category: "dental", 
                lat: 13.7980, 
                lng: 100.3280, 
                desc: "ตรงข้ามมหาวิทยาลัยมหิดล", 
                tel: "-", 
                icon: "tooth", 
                hours: "10.00 - 20.00 น.", 
                details: "บริการอุดฟัน ถอนฟัน รักษารากฟัน",
                rights: "-ประกันสังคม ขูดหินปูนฟรี 900-.<br>-โปรโมชัน นักเรียน นักศึกษา จัดฟันเริ่มต้น 890-.",
                docs: "บัตรประชาชน"
            },
            { id: 103, name: "คลินิกทันตกรรมเฟรชชี่ ศาลายา", category: "dental", lat: 13.8020, lng: 100.3220, desc: "ดูแลสุขภาพช่องปาก", tel: "-", icon: "tooth", hours: "10.00 - 20.00 น.", details: "บริการขูดหินปูน ฟอกสีฟัน" },
            { id: 104, name: "Add Friend Dental Clinic", category: "dental", lat: 13.7990, lng: 100.3190, desc: "สาขา ศาลายา", tel: "-", icon: "tooth", hours: "10.00 - 20.00 น.", details: "บริการทำฟันทั่วไปและเฉพาะทาง" },
            { 
                id: 105, 
                name: "คลินิก ฟ.ฟัน สาขาศาลายา", 
                category: "dental", 
                lat: 13.7960, 
                lng: 100.3300, 
                desc: "บริการทันตกรรม", 
                tel: "-", 
                icon: "tooth", 
                hours: "10.00 - 20.00 น.", 
                details: "บริการทันตกรรมทั่วไป",
                rights: "-ประกันสังคม ทำฟันฟรี 900-./ปี (ขูดหินปูน ถอนฟัน อุดฟัน ผ่าฟันคุด)",
                docs: "บัตรประชาชน"
            },
            { 
                id: 106, 
                name: "Smile Again Dental Clinic", 
                category: "dental", 
                lat: 13.8030, 
                lng: 100.3200, 
                desc: "คืนรอยยิ้มสวยให้คุณ", 
                tel: "-", 
                icon: "tooth", 
                hours: "10.00 - 20.00 น.", 
                details: "บริการจัดฟัน ทันตกรรมความงาม",
                rights: "-ประกันสังคม ทำฟันฟรี 900-./ปี (ขูดหินปูน ถอนฟัน อุดฟัน ผ่าฟันคุด)",
                docs: "บัตรประชาชน"
            },
            { 
                id: 107, 
                name: "Tooth Republic Dental Clinic", 
                category: "dental", 
                lat: 13.7950, 
                lng: 100.3150, 
                desc: "อาณาจักรแห่งรอยยิ้ม", 
                tel: "-", 
                icon: "tooth", 
                hours: "10.00 - 20.00 น.", 
                details: "บริการทันตกรรมสำหรับเด็กและผู้ใหญ่",
                rights: "-ประกันสังคม ทำฟันฟรี 900-./ปี (ขูดหินปูน ถอนฟัน อุดฟัน ผ่าฟันคุด)",
                docs: "บัตรประชาชน"
            },
            { 
                id: 108, 
                name: "คลินิกทันตกรรมสมายล์คอร์เนอร์", 
                category: "dental", 
                lat: 13.8000, 
                lng: 100.3170, 
                desc: "Smile Corner @Salaya", 
                tel: "-", 
                icon: "tooth", 
                hours: "10.00 - 20.00 น.", 
                details: "บริการตรวจสุขภาพฟัน",
                rights: "-ประกันสังคม ทำฟันฟรี 900-./ปี (ขูดหินปูน ถอนฟัน อุดฟัน ผ่าฟันคุด)",
                docs: "บัตรประชาชน"
            },

            // --- Service ---
            { 
                id: 401, 
                name: "ตู้ห่วงใย (Vending Machine)", 
                category: "service", 
                lat: 13.7940, 
                lng: 100.3190, 
                desc: "บริเวณสำนักงานหอพัก ใต้หอ 11", 
                tel: "-", 
                icon: "heart", 
                hours: "08.00-20.00 น. เริ่มรับยาได้ตั้งแต่เวลา 10.00 น.", 
                details: "ตู้จำหน่ายยาสามัญประจำบ้านอัตโนมัติ",
                rights: "-บัตรทอง ตรวจรักษาโรคเบื้องต้น ปรึกษาแพทย์ออนไลน์ และรับยาฟรี",
                docs: "นำบัตรประชาชนตัวจริงมาสแกน"
            },
            { id: 402, name: "ตู้สินค้าอัตโนมัติแจกฟรี", category: "service", lat: 13.7925, lng: 100.3230, desc: "ถุงยางอนามัยและชุดตรวจ HIV", tel: "-", icon: "shield-check", hours: "24 ชั่วโมง", details: "บริการส่งเสริมสุขภาพทางเพศ ฟรี" },
            { 
                id: 403, 
                name: "ศูนย์ให้คำปรึกษา MU Friends", 
                category: "service", 
                lat: 13.7935, 
                lng: 100.3210, 
                desc: "เพื่อนที่ปรึกษาและนันทนาการ", 
                tel: "02-xxx-xxxx", 
                icon: "users", 
                hours: "จันทร์-ศุกร์ 09.00-17.00", 
                details: "บริการให้คำปรึกษาทางใจและพื้นที่พักผ่อน",
                rights: "ให้บริการปรึกษาเรื่องเครียด การเรียน ความสัมพันธ์ และปรับตัว ฟรีสำหรับนักศึกษาและบุคคลากรมหาวิทยาลัยมหิดล"
            },
            
            // --- Fitness ---
            { id: 501, name: "ศูนย์กีฬาและนันทนาการ", category: "fitness", lat: 13.7920, lng: 100.3260, desc: "Sports Complex", tel: "-", icon: "dumbbell", hours: "06.00-21.00 น.", details: "สนามแบดมินตัน, สระว่ายน้ำ, สนามเทนนิส" },
            { 
                id: 502, 
                name: "Fitness Center (MLC)", 
                category: "fitness", 
                lat: 13.7938, 
                lng: 100.3205, 
                desc: "ชั้น 2 อาคารศูนย์การเรียนรู้", 
                tel: "-", 
                icon: "dumbbell", 
                hours: "07.00-20.00 น.", 
                details: "ห้องฟิตเนสครบวงจรสำหรับนักศึกษา",
                rights: "นักศึกษาและบุคคลากรมหาวิทยาลัยมหิดลเข้าใช้บริการฟรี"
            },
            { id: 503, name: "สวนสิรีรุกขชาติ", category: "fitness", lat: 13.7890, lng: 100.3190, desc: "พื้นที่สีเขียว", tel: "-", icon: "dumbbell", hours: "06.00-18.00 น.", details: "เส้นทางวิ่งออกกำลังกายและชมธรรมชาติ" }
        ];

        const map = L.map('map').setView([13.7960, 100.3210], 14);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map);

        let markers = [];
        let currentFilteredData = [];
        let isShowAll = false;
        let userMarker = null;

        const getIconHtml = (iconName, size=18) => {
            if (iconName === 'tooth') {
                return `<div style="width:${size}px; height:${size}px;">${TOOTH_SVG}</div>`;
            }
            return `<i data-lucide="${iconName}" width="${size}" height="${size}"></i>`;
        }

        function openModal(id) {
            const loc = locations.find(l => l.id === id);
            if(!loc) return;
            document.getElementById('modal-title').innerText = loc.name;
            document.getElementById('modal-desc').innerText = loc.desc;
            document.getElementById('modal-hours').innerText = loc.hours;
            document.getElementById('modal-details').innerText = loc.details;
            document.getElementById('modal-tel-btn').href = `tel:${loc.tel}`;
            
            const iconBox = document.getElementById('modal-icon');
            iconBox.innerHTML = getIconHtml(loc.icon, 32);
            lucide.createIcons();

            // Inject Rights and Docs if available
            const rightsSection = document.getElementById('modal-rights-section');
            rightsSection.innerHTML = ''; // Clear previous content

            if (loc.rights) {
                rightsSection.innerHTML += `
                    <div class="bg-emerald-50 p-4 rounded-2xl border border-emerald-100">
                        <div class="flex items-start gap-3">
                            <i data-lucide="shield-check" class="text-emerald-500 mt-0.5 shrink-0" size="18"></i>
                            <div>
                                <span class="font-bold text-emerald-900 text-sm block mb-1">สิทธิการรักษา:</span>
                                <span class="text-emerald-800 text-sm block leading-relaxed">${loc.rights}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            if (loc.docs) {
                rightsSection.innerHTML += `
                    <div class="bg-orange-50 p-4 rounded-2xl border border-orange-100">
                        <div class="flex items-start gap-3">
                            <i data-lucide="file-text" class="text-orange-500 mt-0.5 shrink-0" size="18"></i>
                            <div>
                                <span class="font-bold text-orange-900 text-sm block mb-1">เอกสารที่ต้องเตรียม:</span>
                                <span class="text-orange-800 text-sm block leading-relaxed">${loc.docs}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            lucide.createIcons(); // Re-render icons in new content

            document.getElementById('info-modal').classList.remove('hidden-modal');
        }

        function closeModal() { document.getElementById('info-modal').classList.add('hidden-modal'); }
        document.getElementById('info-modal').addEventListener('click', (e) => { if(e.target.id === 'info-modal') closeModal(); });

        function renderList(data, showAll) {
            const listContainer = document.getElementById('location-list');
            listContainer.innerHTML = '';
            
            const displayData = showAll ? data : data.slice(0, 4);

            displayData.forEach(loc => {
                let colorClass = 'bg-blue-600';
                if(loc.category === 'pharmacy') colorClass = 'bg-emerald-500';
                if(loc.category === 'service') colorClass = 'bg-indigo-500';
                if(loc.category === 'dental') colorClass = 'bg-orange-500';
                if(loc.category === 'clinic') colorClass = 'bg-pink-500';
                if(loc.category === 'fitness') colorClass = 'bg-purple-500';

                // Distance Badge logic
                let distanceBadge = '';
                if(loc.distance) {
                    distanceBadge = `<span class="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full border border-blue-100 whitespace-nowrap">ห่าง ${loc.distance} กม.</span>`;
                }

                const item = document.createElement('div');
                item.className = 'group p-3 rounded-xl border border-slate-100 bg-slate-50 hover:bg-white hover:shadow-md hover:border-blue-100 transition cursor-pointer flex gap-3 items-start animate-fade-in';
                item.onclick = () => {
                    document.getElementById('map').scrollIntoView({ behavior: 'smooth', block: 'center' });
                    map.flyTo([loc.lat, loc.lng], 17);
                    const targetMarker = markers.find(m => m.getLatLng().lat === loc.lat && m.getLatLng().lng === loc.lng);
                    if(targetMarker) targetMarker.openPopup();
                };
                item.innerHTML = `
                    <div class="${colorClass} p-2.5 rounded-lg text-white shadow-sm group-hover:scale-110 transition shrink-0">
                        ${getIconHtml(loc.icon, 18)}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start gap-2">
                            <h3 class="font-bold text-slate-800 text-sm group-hover:text-blue-700 transition truncate">${loc.name}</h3>
                            ${distanceBadge}
                        </div>
                        <p class="text-xs text-slate-500 mt-1 line-clamp-1">${loc.desc}</p>
                    </div>
                `;
                listContainer.appendChild(item);
            });
            lucide.createIcons();

            const showMoreBtn = document.getElementById('show-more-btn');
            if (data.length > 4 && !showAll) {
                showMoreBtn.classList.remove('hidden');
                showMoreBtn.innerText = `ดูเพิ่มเติมอีก ${data.length - 4} แห่ง ...`;
            } else {
                showMoreBtn.classList.add('hidden');
            }
        }

        // --- Geolocation Logic ---
        function findUserLocation() {
            if (!navigator.geolocation) {
                alert("เบราว์เซอร์ของคุณไม่รองรับการระบุตำแหน่ง");
                return;
            }
            // Show loading state (optional UX)
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;
                    
                    // 1. Add/Update User Marker
                    if (userMarker) map.removeLayer(userMarker);
                    userMarker = L.marker([userLat, userLng], {
                        icon: L.divIcon({ 
                            className: 'custom-user-pin', 
                            html: '<div class="user-pulse"></div>',
                            iconSize: [20, 20],
                            iconAnchor: [10, 10]
                        })
                    }).addTo(map);

                    // 2. Fly to user
                    map.setView([userLat, userLng], 15);

                    // 3. Calculate Distances
                    locations.forEach(loc => {
                        const distance = map.distance([userLat, userLng], [loc.lat, loc.lng]); // meters
                        loc.distance = (distance / 1000).toFixed(2); // km string
                        // Add raw distance for sorting
                        loc._rawDist = distance; 
                    });

                    // 4. Sort and Re-render (Current Filter)
                    // We need to re-apply the current filter logic to see the sorted list
                    const activeBtn = document.querySelector('.filter-btn.bg-blue-600'); // Find active button
                    const activeCat = activeBtn ? activeBtn.dataset.cat : 'all';
                    filterLocations(activeCat);

                    // Show status
                    document.getElementById('user-status').classList.remove('hidden');
                },
                (error) => {
                    console.error(error);
                    alert("ไม่สามารถระบุตำแหน่งได้ กรุณาเปิด GPS");
                }
            );
        }

        function filterLocations(cat) {
            // Update Buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                const isMatch = btn.dataset.cat === cat;
                btn.className = isMatch 
                    ? 'bg-blue-600 text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-500 transition shadow-md filter-btn' 
                    : 'bg-white text-blue-900 px-5 py-2.5 rounded-xl font-bold hover:bg-blue-50 transition flex items-center gap-2 shadow-sm filter-btn';
            });

            // Filter Data
            currentFilteredData = (cat === 'all') ? locations : locations.filter(l => l.category === cat);
            
            // Sort by distance if user location is known
            if(locations[0]._rawDist !== undefined) {
                currentFilteredData.sort((a, b) => a._rawDist - b._rawDist);
            }

            isShowAll = false;

            // Update Map Markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            
            currentFilteredData.forEach(loc => {
                let colorClass = 'bg-blue-600';
                if(loc.category === 'pharmacy') colorClass = 'bg-emerald-500';
                if(loc.category === 'service') colorClass = 'bg-indigo-500';
                if(loc.category === 'dental') colorClass = 'bg-orange-500';
                if(loc.category === 'clinic') colorClass = 'bg-pink-500';
                if(loc.category === 'fitness') colorClass = 'bg-purple-500';

                const customIcon = L.divIcon({
                    className: 'custom-pin',
                    html: `<div class="${colorClass} w-8 h-8 rounded-full border-2 border-white shadow-lg flex items-center justify-center text-white">
                            ${getIconHtml(loc.icon, 16)}
                           </div>`,
                    iconSize: [32, 32], iconAnchor: [16, 32], popupAnchor: [0, -34]
                });
                
                const marker = L.marker([loc.lat, loc.lng], { icon: customIcon }).addTo(map);
                marker.bindPopup(`
                    <div class="font-sarabun">
                        <div class="${colorClass} text-white p-3 font-bold text-base flex items-center gap-2">${loc.name}</div>
                        <div class="p-3 bg-white text-sm text-slate-600">
                            <p class="mb-3">${loc.desc}</p>
                            <div class="flex gap-2">
                                <button onclick="openModal(${loc.id})" class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 py-1.5 rounded-lg text-xs font-bold border border-slate-200 transition">ℹ️ ข้อมูลเพิ่มเติม</button>
                                <a href="tel:${loc.tel}" class="px-3 py-1.5 bg-green-100 hover:bg-green-200 text-green-700 rounded-lg font-bold text-xs transition flex items-center">📞 โทร</a>
                            </div>
                        </div>
                    </div>
                `, { className: 'custom-popup' });
                markers.push(marker);
            });

            renderList(currentFilteredData, isShowAll);
        }

        function toggleShowMore() {
            isShowAll = true;
            renderList(currentFilteredData, isShowAll);
        }

        // Init
        filterLocations('all');
    </script>
</body>
</html>